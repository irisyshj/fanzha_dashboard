{% extends "base.html" %}

{% block title %}
{% if article %}{{ article.title }} - 反诈全国快讯解析{% else %}文章不存在{% endif %}
{% endblock %}

{% block content %}
<div class="container">
    {% if article %}
    <!-- 文章内容 -->
    <article class="article-detail">
        <div class="article-header">
            <h1 class="article-title">{{ article.title }}</h1>
            <div class="article-meta">
                <span class="article-date">{{ article.date[:10] if article.date else '' }}</span>
                <span class="article-source">@ {{ article.source }}</span>
            </div>
        </div>

        <!-- 案件信息卡片 -->
        <div class="case-info-cards">
            {% if article.scam_type %}
            <div class="info-card scam-type-card">
                <div class="info-card-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                </div>
                <div class="info-card-content">
                    <div class="info-card-label">诈骗类型</div>
                    <div class="info-card-value">{{ article.scam_type }}</div>
                </div>
            </div>
            {% endif %}

            <div class="info-card source-card">
                <div class="info-card-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                    </svg>
                </div>
                <div class="info-card-content">
                    <div class="info-card-label">信息来源</div>
                    <div class="info-card-value">{{ article.source }}</div>
                </div>
            </div>

            {% if article.location %}
            <div class="info-card location-card">
                <div class="info-card-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                        <circle cx="12" cy="10" r="3"/>
                    </svg>
                </div>
                <div class="info-card-content">
                    <div class="info-card-label">案件地点</div>
                    <div class="info-card-value">{{ article.location }}</div>
                </div>
            </div>
            {% endif %}

            <div class="info-card time-card">
                <div class="info-card-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                </div>
                <div class="info-card-content">
                    <div class="info-card-label">案件时间</div>
                    <div class="info-card-value">{{ article.date[:10] if article.date else '未知' }}</div>
                </div>
            </div>
        </div>

        <!-- 案件核心特点 -->
        {% if article.key_features %}
        <div class="case-section">
            <h2 class="case-section-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                案件核心特点
            </h2>
            <ul class="case-features-list">
                {% for feature in article.key_features[:5] %}
                <li class="feature-item">{{ feature }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- 反诈关键技术 -->
        {% if article.anti_fraud_tech %}
        <div class="case-section">
            <h2 class="case-section-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                反诈关键技术
            </h2>
            <div class="tech-tags">
                {% for tech in article.anti_fraud_tech %}
                <span class="tech-tag">{{ tech }}</span>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- 详细内容 -->
        <div class="article-content">
            <!-- 原文链接按钮 -->
            {% if article.address %}
            <div class="original-link">
                <a href="{{ article.address }}" target="_blank" rel="noopener noreferrer" class="btn-original">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                        <polyline points="15 3 21 3 21 9"/>
                        <line x1="10" y1="14" x2="21" y2="3"/>
                    </svg>
                    阅读原文
                </a>
            </div>
            {% endif %}

            <!-- 正文内容 -->
            <div class="article-body">
                {{ article.summary|format_article }}
            </div>

            {% if article.content %}
            <div class="article-full-content">
                {{ article.content|format_article }}
            </div>
            {% endif %}
        </div>

        <div class="article-actions">
            <a href="{{ url_for('views.index') }}" class="btn-back">&larr; 返回首页</a>
        </div>
    </article>

    <!-- 评论区 -->
    <section class="comments-section">
        <h2 class="comments-title">评论</h2>

        <!-- 评论输入 -->
        <form class="comment-form" id="commentForm">
            <div class="form-group">
                <input type="text" id="commentAuthor" placeholder="你的昵称" required maxlength="100">
            </div>
            <div class="form-group">
                <textarea id="commentContent" placeholder="写下你的评论..." required maxlength="1000" rows="4"></textarea>
            </div>
            <button type="submit" class="btn-submit">发表评论</button>
        </form>

        <!-- 评论列表 -->
        <div class="comments-list" id="commentsList">
            <div class="loading">加载评论中...</div>
        </div>
    </section>

    {% elif error %}
    <div class="error-message">
        <h2>错误</h2>
        <p>{{ error }}</p>
        <a href="{{ url_for('views.index') }}" class="btn-back">返回首页</a>
    </div>
    {% else %}
    <div class="error-message">
        <h2>文章不存在</h2>
        <p>抱歉，您访问的文章不存在。</p>
        <a href="{{ url_for('views.index') }}" class="btn-back">返回首页</a>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/comments.js') }}"></script>
<script>
    const ARTICLE_ID = '{{ article.id if article else "" }}';
</script>
{% endblock %}
